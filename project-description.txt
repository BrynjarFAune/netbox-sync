Create a program for populating a netbox instance over API

Configuration required (see .env.example for template):
- netbox_url: Your NetBox instance URL
- netbox_version: Target NetBox version
- netbox_token: Your NetBox API token
- fortigate_url: Your FortiGate device URL
- fortigate_api_key: Your FortiGate API key
- Microsoft API details:
	- client_secret: Your Azure client secret
	- client_id: Your Azure client ID
	- tenant_id: Your Azure tenant ID

# Project: NetBox Infra Sync (Containerized)

## Goal
Continuously keep NetBox in sync with FortiGate, Intune (Graph API), and ESET.

## Outcomes (acceptance)
- ≥95% infra reflected in NetBox within 24h (configurable)
- Full sync <5 min for current estate
- Idempotent: re-running causes no unintended diffs
- Clear audit trail of creates/updates/deletes

## High-level design
- **Workers (fetchers):** `fortigate`, `intune`, `eset`
- **Normalizer:** unifies models → canonical schema
- **Reconciler:** diffs canonical vs NetBox → PATCH/POST/DELETE
- **State store:** last-seen hashes & run logs (SQLite or Postgres; SQLite ok to start)
- **API clients:** NetBox + providers (rate-limited, retried, backoff)
- **Scheduler:** cron-like inside container **or** external (K8s CronJob)

## Data scope → NetBox targets
- **FortiGate:** VLANs, prefixes, interfaces, routes (optional), ARP/DHCP leases → `ipam.*`, `dcim.Interface`, `dcim.Device` (FW), `tenancy.*`
- **Intune:** Devices, owners, OS, compliance → `dcim.Device`/`virtualization.VirtualMachine` (choose strategy), `custom_fields`: `owner`, `compliance`, `serial`, `device_id`
- **ESET:** NIC details, AV status → extend `custom_fields/tags`: `av_status`, `eset_last_seen`, per-interface MAC/vendor

## Reconciliation rules (keyed by)
- **Devices:** prefer stable IDs (Intune `azureDeviceId` / ESET UUID / FortiGate SN). Maintain an origin map `{external_id -> netbox_id}`
- **Interfaces:** match by `(device, mac)`; fallback `(device, name)`
- **IP addresses:** authoritative from FortiGate; Intune/ESET augment
- **Deletes:** soft-delete by tag `source:xyz` + `stale_since`; hard-delete after N days (config)

## Containerization
- Single image with subcommands:
  - `sync fortigate|intune|eset|all`
  - `serve` (HTTP /healthz, /metrics)
  - `migrate` (init state DB)
- Minimal runtime deps; distroless or alpine
- Config via **env vars** (12-factor):
  - `NETBOX_URL`, `NETBOX_TOKEN`
  - `FGT_HOST`, `FGT_TOKEN`
  - `GRAPH_TENANT_ID`, `GRAPH_CLIENT_ID`, `GRAPH_CLIENT_SECRET`
  - `ESET_BASE_URL`, `ESET_TOKEN`
  - `SYNC_INTERVAL_CRON` (if internal scheduler)
  - `DELETE_GRACE_DAYS`, `LOG_LEVEL`
- Secrets mounted from Docker/K8s secrets

### Example `docker-compose.yml`
```yaml
services:
  netbox-sync:
    image: registry.example/netbox-sync:latest
    command: ["sync","all"]
    env_file: .env
    restart: unless-stopped

